<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UCC Revenue Analysis Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #e0e2e9 0%, #1fee9f 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #94c7fa, #88e788);
            color: rgb(0, 0, 0);
            padding: 30px;
            text-align: center;
        }

        .header-logo {
            width: 230px;
            height: 140px;
            margin: 0 auto 15px auto;
            display: block;
            border-radius: 10px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .upload-section {
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .upload-area {
            border: 3px dashed #62ec69;
            border-radius: 10px;
            padding: 40px;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #39eb56;
            background: #f1f8ff;
        }

        .upload-area.dragover {
            border-color: #27ae60;
            background: #f1f9f1;
        }

        .file-input {
            display: none;
        }

        .upload-button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .dashboard {
            padding: 30px;
            display: none;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .analysis-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }

        .analysis-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #86f10a;
            padding-bottom: 10px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #e9ecef;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
            border-right: 1px solid #e9ecef;
        }

        th:last-child,
        td:last-child {
            border-right: none;
        }

        th {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-weight: 600;
            border-bottom: 2px solid #2c3e50;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #e3f2fd;
        }

        .summary-section {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #edf0f3, #e5ebf0);
            color: rgb(0, 0, 0);
            padding: 30px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .summary-section h3 {
            color: rgb(20, 20, 20);
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 20px;
        }

        .summary-points {
            list-style: none;
            padding: 0;
        }

        .summary-points li {
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
        }

        .summary-points li::before {
            content: "‚ñ∂";
            position: absolute;
            left: 0;
            color: #3498db;
        }

        .alert {
            background: #f1ee1f;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .analysis-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        @keyframes pulse {
            0% { box-shadow: 0 15px 40px rgba(233, 30, 99, 0.4); }
            50% { box-shadow: 0 20px 50px rgba(233, 30, 99, 0.6); }
            100% { box-shadow: 0 15px 40px rgba(233, 30, 99, 0.4); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <img src="logo.png" alt="Logo" class="header-logo">
            <h1>üèõÔ∏è UCC Revenue Analysis Dashboard</h1>
            <p>Daily Charge Collection Analysis & Performance Insights</p>
        </div>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <h3>üìÅ Upload Your Daily Charge Collection CSV</h3>
                <p>Drag and drop your CSV file here or click to browse</p>
                <input type="file" id="fileInput" class="file-input" accept=".csv" />
                <button class="upload-button"
                    onclick="event.stopPropagation(); document.getElementById('fileInput').click()">
                    Choose File
                </button>
            </div>
            <div id="fileInfo" style="margin-top: 15px; color: #666;"></div>
        </div>

        <div class="dashboard" id="dashboard">
            <!-- Overall Collection Metrics -->
            <div class="metrics-grid" id="metricsGrid">
                <!-- Metrics cards will be populated here -->
            </div>

            <!-- Analysis Grid -->
            <div class="analysis-grid" id="analysisGrid">
                <!-- Analysis cards will be populated here -->
            </div>
        </div>
    </div>

    <script>
        let csvData = [];
        let processedData = {};

        // File upload handlers
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const fileInfo = document.getElementById('fileInfo');
        const dashboard = document.getElementById('dashboard');

        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        uploadArea.addEventListener('click', (e) => {
            // Only trigger file input if clicking on the upload area itself, not on child elements
            if (e.target === uploadArea || e.target.tagName === 'H3' || e.target.tagName === 'P') {
                fileInput.click();
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // CSV parsing function with proper handling of quoted fields
        function parseCSV(text) {
            const lines = text.split('\n');
            const headers = parseCSVLine(lines[0]);
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length === headers.length) {
                        const row = {};
                        headers.forEach((header, index) => {
                            row[header.replace(/"/g, '')] = values[index].replace(/"/g, '');
                        });
                        data.push(row);
                    }
                }
            }
            return data;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];

                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            return result;
        }

        function handleFile(file) {
            if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                alert('Please upload a CSV file');
                return;
            }

            fileInfo.innerHTML = `<p class="success">Loading: ${file.name} (${(file.size / 1024).toFixed(1)} KB)</p>`;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    csvData = parseCSV(e.target.result);
                    console.log('Parsed CSV data:', csvData);

                    if (csvData.length === 0) {
                        throw new Error('No data found in CSV file');
                    }

                    processData();
                    generateDashboard();
                    dashboard.style.display = 'block';

                    // Hide upload section after successful upload
                    document.querySelector('.upload-section').style.display = 'none';

                    fileInfo.innerHTML = `<p class="success">Successfully loaded ${csvData.length} records from ${file.name}</p>`;
                } catch (error) {
                    console.error('Error processing file:', error);
                    fileInfo.innerHTML = `<p class="alert">Error: ${error.message}</p>`;
                }
            };
            reader.readAsText(file);
        }

        function processData() {
            console.log('Processing data...');

            // Reset processed data
            processedData = {
                totalAmount: 0,
                totalTransactions: 0,
                paymentModes: {},
                zones: {},
                wards: {},
                supervisors: {},
                supervisorPaymentModes: {}, // New: Track payment modes per supervisor
                propertyTypes: {},
                propertySubTypes: {},
                anomalies: [],
                totalWards: 70,
                activeWards: new Set(),
                inactiveWards: []
            };

            csvData.forEach(row => {
                // Parse amount collected
                const amount = parseFloat(row['Amount Collected']) || 0;
                processedData.totalAmount += amount;
                processedData.totalTransactions++;

                // Payment mode analysis
                const paymentMode = row['Payment Mode'] || 'Unknown';
                if (!processedData.paymentModes[paymentMode]) {
                    processedData.paymentModes[paymentMode] = { count: 0, amount: 0 };
                }
                processedData.paymentModes[paymentMode].count++;
                processedData.paymentModes[paymentMode].amount += amount;

                // Zone analysis
                const zone = row['Zone Name'] || 'Unknown';
                if (!processedData.zones[zone]) {
                    processedData.zones[zone] = { count: 0, amount: 0 };
                }
                processedData.zones[zone].count++;
                processedData.zones[zone].amount += amount;

                // Ward analysis
                const ward = row['Ward Name'] || 'Unknown';
                if (!processedData.wards[ward]) {
                    processedData.wards[ward] = { count: 0, amount: 0 };
                }
                processedData.wards[ward].count++;
                processedData.wards[ward].amount += amount;

                // Track active wards
                if (ward !== 'Unknown') {
                    processedData.activeWards.add(ward);
                }

                // Supervisor analysis
                const supervisor = row['Supervisor Name'] || 'Unknown';
                if (!processedData.supervisors[supervisor]) {
                    processedData.supervisors[supervisor] = { count: 0, amount: 0 };
                }
                processedData.supervisors[supervisor].count++;
                processedData.supervisors[supervisor].amount += amount;

                // Supervisor Payment Mode analysis (New)
                if (!processedData.supervisorPaymentModes[supervisor]) {
                    processedData.supervisorPaymentModes[supervisor] = {};
                }
                if (!processedData.supervisorPaymentModes[supervisor][paymentMode]) {
                    processedData.supervisorPaymentModes[supervisor][paymentMode] = { count: 0, amount: 0 };
                }
                processedData.supervisorPaymentModes[supervisor][paymentMode].count++;
                processedData.supervisorPaymentModes[supervisor][paymentMode].amount += amount;

                // Property Type analysis
                const propertyType = row['Property Type Name'] || 'Unknown';
                if (!processedData.propertyTypes[propertyType]) {
                    processedData.propertyTypes[propertyType] = { count: 0, amount: 0 };
                }
                processedData.propertyTypes[propertyType].count++;
                processedData.propertyTypes[propertyType].amount += amount;

                // Property Sub-Type analysis
                const propertySubType = row['Property Sub-Type Name'] || 'Unknown';
                if (!processedData.propertySubTypes[propertySubType]) {
                    processedData.propertySubTypes[propertySubType] = { count: 0, amount: 0 };
                }
                processedData.propertySubTypes[propertySubType].count++;
                processedData.propertySubTypes[propertySubType].amount += amount;

                // Anomaly detection
                if (amount === 0) {
                    processedData.anomalies.push(`Zero collection: ${row['Customer Name']} in Ward ${ward}`);
                }
            });

            // Find inactive wards (wards that have no collections)
            const allWardNames = [
                '01-Birjapur', '02-Ambedkar Nagar', '03-Girdharpur', '04-Ishapur Yamunapar', '05-Bharatpur Gate',
                '06-Aduki', '07-Lohvan', '08-Atas', '09-Gandhi Nagar', '10-Aurangabad First',
                '11-Tarsi', '12-Radhe Shyam Colony', '13-Sunrakh', '14-Lakshmi Nagar Yamunapar', '15-Maholi First',
                '16-Bakalpur', '17-Bairaagpura', '18-General ganj', '19-Ramnagar Yamunapar', '20-Krishna Nagar First',
                '21-Chaitanya Bihar', '22-Badhri Nagar', '23-Aheer Pada', '24-Sarai Azamabad', '25-Chharaura',
                '26-Naya Nagla', '27-Baad', '28-Aurangabad Second', '29-Koyla Alipur', '30-Krishna Nagar Second',
                '31-Navneet Nagar', '32-Ranchibagar', '33-Palikhera', '34-Radhaniwas', '35-Bankhandi',
                '36-Jaisingh Pura', '37-Baldevpuri', '38-Civil lines', '39-Mahavidhya Colony', '40-Rajkumar',
                '41-Dhaulipiau', '42-Manoharpur', '43-Ganeshra', '44-Radhika Bihar', '45-Birla Mandir',
                '46-Radha Nagar', '47-Dwarkapuri', '48-Satoha Asangpur', '49-Daimpiriyal Nagar', '50-Patharpura',
                '51-Gaushala Nagar', '52-Chandrapuri', '53-Krishna puri', '54-Pratap Nagar', '55-Govind Nagar',
                '56-Mandi Randas', '57-Balajipuram', '58-Gau Ghat', '59-Maholi Second', '60-Jagannath Puri',
                '61-Chaubia para', '62-Mathura Darwaza', '63-Maliyaan Sadar', '64-Ghati Bahalray', '65-Holi Gali',
                '66-Keshighat', '67-Kemar Van', '68-Shanti Nagar', '69-Ratan Chhatri', '70-Biharipur'
            ];

            processedData.inactiveWards = allWardNames.filter(wardName => {
                // Check if this ward name appears in the active wards
                // We need to check both the full name and just the number part
                const wardNumber = wardName.split('-')[0];
                return !processedData.activeWards.has(wardNumber) && !processedData.activeWards.has(wardName);
            });

            console.log('Processed data:', processedData);
            console.log('Active wards:', Array.from(processedData.activeWards));
            console.log('Inactive wards:', processedData.inactiveWards);
        }

        function generateDashboard() {
            generateMetrics();
            generatePaymentModeAnalysis();
            generateLocationAnalysis();
            generatePropertyTypeAnalysis();
            generateSupervisorAnalysis();
            generateSupervisorPaymentModeAnalysis(); // New function
            generateExecutiveSummary();
        }

        function generateMetrics() {
            const metricsGrid = document.getElementById('metricsGrid');

            const metrics = [
                {
                    label: 'Total Amount Collected',
                    value: `‚Çπ${processedData.totalAmount.toLocaleString('en-IN', { maximumFractionDigits: 0 })}`,
                    gradient: 'linear-gradient(135deg, #27ae60, #2ecc71)'
                },
                {
                    label: 'Total Transactions',
                    value: processedData.totalTransactions.toLocaleString('en-IN'),
                    gradient: 'linear-gradient(135deg, #3498db, #5dade2)'
                },
                {
                    label: 'Average per Transaction',
                    value: `‚Çπ${(processedData.totalAmount / processedData.totalTransactions).toFixed(0)}`,
                    gradient: 'linear-gradient(135deg, #9b59b6, #bb8fce)'
                },
                {
                    label: 'Active Supervisors',
                    value: Object.keys(processedData.supervisors).length,
                    gradient: 'linear-gradient(135deg, #e67e22, #f39c12)'
                }
            ];

            metricsGrid.innerHTML = metrics.map(metric => `
                <div class="metric-card" style="background: ${metric.gradient};">
                    <div class="metric-value">${metric.value}</div>
                    <div class="metric-label">${metric.label}</div>
                </div>
            `).join('');
        }

        function generatePaymentModeAnalysis() {
            const analysisGrid = document.getElementById('analysisGrid');

            // Payment mode table
            const paymentModeData = Object.entries(processedData.paymentModes)
                .map(([mode, data]) => ({
                    mode,
                    count: data.count,
                    amount: data.amount,
                    countPercent: (data.count / processedData.totalTransactions * 100).toFixed(1),
                    amountPercent: (data.amount / processedData.totalAmount * 100).toFixed(1)
                }))
                .sort((a, b) => b.amount - a.amount);

            const paymentModeTable = `
                <div class="analysis-card">
                    <h3>üí≥ Payment Mode Analysis</h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #3498db;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <div>
                                <strong style="color: #2c3e50; font-size: 1.1em;">Report Date:</strong> 
                                <span style="color: #3498db; font-weight: bold;">${new Date().toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            })}</span>
                            </div>
                            <div>
                                <strong style="color: #2c3e50; font-size: 1.1em;">Total Collections:</strong> 
                                <span style="color: #27ae60; font-weight: bold; font-size: 1.2em;">‚Çπ${processedData.totalAmount.toLocaleString('en-IN')}</span>
                            </div>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px; text-align: center;">S.No.</th>
                                    <th>Payment Mode</th>
                                    <th>Count</th>
                                    <th>Amount (‚Çπ)</th>
                                    <th>% Share (Count)</th>
                                    <th>% Share (Amount)</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${paymentModeData.map((item, index) => `
                                    <tr>
                                        <td style="font-weight: bold; color: #3498db; text-align: center; border: 1px solid #dee2e6;">${index + 1}</td>
                                        <td style="border: 1px solid #dee2e6;">${item.mode}</td>
                                        <td style="border: 1px solid #dee2e6;">${item.count.toLocaleString('en-IN')}</td>
                                        <td style="border: 1px solid #dee2e6;">‚Çπ${item.amount.toLocaleString('en-IN')}</td>
                                        <td style="border: 1px solid #dee2e6;">${item.countPercent}%</td>
                                        <td style="border: 1px solid #dee2e6;">${item.amountPercent}%</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            analysisGrid.innerHTML = paymentModeTable;
        }

        function generateLocationAnalysis() {
            // Zone analysis
            const zoneData = Object.entries(processedData.zones)
                .map(([zone, data]) => ({ zone, ...data }))
                .sort((a, b) => b.amount - a.amount);

            const zoneAnalysis = `
                <div class="analysis-card">
                    <h3>üó∫Ô∏è Zone-wise Collection</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px; text-align: center;">S.No.</th>
                                    <th>Zone</th>
                                    <th>Transactions</th>
                                    <th>Total Amount (‚Çπ)</th>
                                    <th>Avg per Transaction (‚Çπ)</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${zoneData.map((zone, index) => `
                                    <tr>
                                        <td style="font-weight: bold; color: #3498db; text-align: center; border: 1px solid #dee2e6;">${index + 1}</td>
                                        <td style="border: 1px solid #dee2e6;">Zone ${zone.zone}</td>
                                        <td style="border: 1px solid #dee2e6;">${zone.count.toLocaleString('en-IN')}</td>
                                        <td style="border: 1px solid #dee2e6;">‚Çπ${zone.amount.toLocaleString('en-IN')}</td>
                                        <td style="border: 1px solid #dee2e6;">‚Çπ${(zone.amount / zone.count).toFixed(0)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Ward Performance Analysis
            const wardPerformanceAnalysis = `
                <div class="analysis-card" style="grid-column: 1 / -1;">
                    <h3>üìä Ward Performance Overview</h3>
                    
                    <!-- Performance Metrics Cards -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);">
                            <div style="font-size: 3em; font-weight: bold; margin-bottom: 10px;">${processedData.activeWards.size}</div>
                            <div style="font-size: 1.2em; opacity: 0.9;">Active Wards</div>
                            <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.8;">Successfully Collecting</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);">
                            <div style="font-size: 3em; font-weight: bold; margin-bottom: 10px;">${processedData.inactiveWards.length}</div>
                            <div style="font-size: 1.2em; opacity: 0.9;">Inactive Wards</div>
                            <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.8;">Zero Collections</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);">
                            <div style="font-size: 3em; font-weight: bold; margin-bottom: 10px;">${((processedData.activeWards.size / processedData.totalWards) * 100).toFixed(1)}%</div>
                            <div style="font-size: 1.2em; opacity: 0.9;">Collection Rate</div>
                            <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.8;">Ward Coverage</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 8px 25px rgba(243, 156, 18, 0.3);">
                            <div style="font-size: 3em; font-weight: bold; margin-bottom: 10px;">${processedData.totalWards}</div>
                            <div style="font-size: 1.2em; opacity: 0.9;">Total Wards</div>
                            <div style="font-size: 0.9em; margin-top: 8px; opacity: 0.8;">Municipal Coverage</div>
                        </div>
                    </div>

                    ${processedData.inactiveWards.length > 0 ? `
                        <!-- Critical Alert Section -->
                        <div style="background: linear-gradient(135deg, #e91e63, #ad1457); color: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 15px 40px rgba(233, 30, 99, 0.4); border: 3px solid #f48fb1; animation: pulse 2s infinite;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px;">
                                <span style="font-size: 2.5em; margin-right: 15px; animation: bounce 1s infinite;">üö®</span>
                                <div>
                                    <h4 style="margin: 0; font-size: 1.6em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">CRITICAL REVENUE GAP ALERT</h4>
                                    <p style="margin: 5px 0 0 0; opacity: 0.95; font-size: 1.1em; font-weight: 600;">‚ö° Immediate action required for revenue recovery ‚ö°</p>
                                </div>
                            </div>
                            
                            <div style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                                <h5 style="margin: 0 0 15px 0; font-size: 1.2em;">Wards with ZERO Collections (${processedData.inactiveWards.length} wards):</h5>
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px;">
                                    ${processedData.inactiveWards.map(ward => `
                                        <div style="background: rgba(255, 255, 255, 0.2); padding: 12px 8px; border-radius: 8px; text-align: center; font-weight: bold; font-size: 0.95em; word-wrap: break-word; overflow-wrap: break-word; line-height: 1.2;">
                                            ${ward}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px;">
                                <h6 style="margin: 0 0 10px 0; font-size: 1em;">üí∞ Revenue Impact Analysis:</h6>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; font-size: 0.9em;">
                                    <div>‚Ä¢ <strong>Missing Coverage:</strong> ${((processedData.inactiveWards.length / processedData.totalWards) * 100).toFixed(1)}% of total wards</div>
                                    <div>‚Ä¢ <strong>Potential Revenue Loss:</strong> Significant municipal income gap</div>
                                    <div>‚Ä¢ <strong>Action Required:</strong> Deploy supervisors immediately</div>
                                    <div>‚Ä¢ <strong>Priority Level:</strong> URGENT - Revenue Recovery</div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- Ward Status Breakdown -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border: 1px solid #e9ecef;">
                        <h5 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 1.3em;">üìà Ward Status Summary</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div style="text-align: center; padding: 15px;">
                                <div style="font-size: 1.8em; color: #27ae60; font-weight: bold;">${processedData.activeWards.size}</div>
                                <div style="color: #27ae60; font-weight: 600;">‚úÖ Performing Wards</div>
                                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Revenue generating units</div>
                            </div>
                            
                            <div style="text-align: center; padding: 15px;">
                                <div style="font-size: 1.8em; color: #e74c3c; font-weight: bold;">${processedData.inactiveWards.length}</div>
                                <div style="color: #e74c3c; font-weight: 600;">‚ùå Non-Performing Wards</div>
                                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Require immediate intervention</div>
                            </div>
                            
                            <div style="text-align: center; padding: 15px;">
                                <div style="font-size: 1.8em; color: #3498db; font-weight: bold;">${((processedData.activeWards.size / processedData.totalWards) * 100).toFixed(0)}%</div>
                                <div style="color: #3498db; font-weight: 600;">üìä Efficiency Rate</div>
                                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">Target: 100% coverage</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Ward analysis (top 10)
            const wardData = Object.entries(processedData.wards)
                .map(([ward, data]) => ({ ward, ...data }))
                .sort((a, b) => b.amount - a.amount)
                .slice(0, 10);

            const wardAnalysis = `
                <div class="analysis-card">
                    <h3>üèòÔ∏è Top 10 Ward Performance</h3>
                    <div class="chart-container">
                        <canvas id="wardChart"></canvas>
                    </div>
                </div>
            `;

            document.getElementById('analysisGrid').innerHTML += zoneAnalysis + wardPerformanceAnalysis + wardAnalysis;

            // Create ward chart
            setTimeout(() => {
                const ctx = document.getElementById('wardChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: wardData.map(item => `Ward ${item.ward}`),
                        datasets: [{
                            label: 'Amount Collected (‚Çπ)',
                            data: wardData.map(item => item.amount),
                            backgroundColor: 'rgba(52, 152, 219, 0.8)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function (value) {
                                        return '‚Çπ' + value.toLocaleString('en-IN');
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45
                                }
                            }
                        }
                    }
                });
            }, 200);
        }

        function generatePropertyTypeAnalysis() {
            // Property Type analysis
            const propertyTypeData = Object.entries(processedData.propertyTypes)
                .map(([type, data]) => ({ type, ...data }))
                .sort((a, b) => b.amount - a.amount);

            const propertyTypeAnalysis = `
                <div class="analysis-card">
                    <h3>üè¢ Property Type Collection Analysis</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px; text-align: center;">S.No.</th>
                                    <th>Property Type</th>
                                    <th>Total Count</th>
                                    <th>Total Amount (‚Çπ)</th>
                                    <th>Avg per Property (‚Çπ)</th>
                                    <th>% Share (Amount)</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${propertyTypeData.map((item, index) => `
                                    <tr>
                                        <td style="font-weight: bold; color: #3498db; text-align: center; border: 1px solid #dee2e6;">${index + 1}</td>
                                        <td style="font-weight: bold; color: ${item.type === 'Commercial' ? '#e67e22' : item.type === 'Residential' ? '#27ae60' : '#3498db'}; border: 1px solid #dee2e6;">${item.type}</td>
                                        <td style="border: 1px solid #dee2e6;">${item.count.toLocaleString('en-IN')}</td>
                                        <td style="border: 1px solid #dee2e6;">‚Çπ${item.amount.toLocaleString('en-IN')}</td>
                                        <td style="border: 1px solid #dee2e6;">‚Çπ${(item.amount / item.count).toFixed(0)}</td>
                                        <td style="border: 1px solid #dee2e6;">${((item.amount / processedData.totalAmount) * 100).toFixed(1)}%</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Property Sub-Type analysis (top 10)
            const propertySubTypeData = Object.entries(processedData.propertySubTypes)
                .map(([subType, data]) => ({ subType, ...data }))
                .sort((a, b) => b.amount - a.amount)
                .slice(0, 10);

            const propertySubTypeAnalysis = `
                <div class="analysis-card">
                    <h3>üèòÔ∏è Top 10 Property Sub-Type Collections</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px; text-align: center;">S.No.</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px;">Property Sub-Type</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px;">Count</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px;">Total Amount (‚Çπ)</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px;">Avg per Unit (‚Çπ)</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px;">Performance</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${propertySubTypeData.map((item, index) => {
                let performanceIcon;
                let performanceColor;
                if (index < 3) {
                    performanceIcon = 'üèÜ Top';
                    performanceColor = '#27ae60';
                } else if (index < 7) {
                    performanceIcon = '‚≠ê Good';
                    performanceColor = '#f39c12';
                } else {
                    performanceIcon = 'üìä Average';
                    performanceColor = '#3498db';
                }
                return `
                                        <tr>
                                            <td style="font-weight: bold; color: #3498db; text-align: center; border: 1px solid #dee2e6;">${index + 1}</td>
                                            <td style="font-size: 0.9em; border: 1px solid #dee2e6;">${item.subType}</td>
                                            <td style="border: 1px solid #dee2e6;">${item.count.toLocaleString('en-IN')}</td>
                                            <td style="border: 1px solid #dee2e6;">‚Çπ${item.amount.toLocaleString('en-IN')}</td>
                                            <td style="border: 1px solid #dee2e6;">‚Çπ${(item.amount / item.count).toFixed(0)}</td>
                                            <td style="color: ${performanceColor}; font-weight: bold; border: 1px solid #dee2e6;">${performanceIcon}</td>
                                        </tr>
                                    `;
            }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            document.getElementById('analysisGrid').innerHTML += propertyTypeAnalysis + propertySubTypeAnalysis;
        }

        function generateSupervisorAnalysis() {
            const supervisorData = Object.entries(processedData.supervisors)
                .map(([supervisor, data]) => ({
                    supervisor,
                    ...data,
                    efficiency: (data.amount / data.count) || 0
                }))
                .sort((a, b) => b.amount - a.amount);

            const supervisorAnalysis = `
                <div class="analysis-card" style="grid-column: 1 / -1;">
                    <h3>üë• Supervisor Performance Analysis</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px; text-align: center;">S.No.</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px;">Supervisor Name</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px;">Total Collections</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px;">Total Amount (‚Çπ)</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px;">Avg per Collection (‚Çπ)</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px;">Performance Rating</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${supervisorData.map((supervisor, index) => {
                let rating;
                let ratingColor;
                if (index < 3) {
                    rating = '‚≠ê Top Performer';
                    ratingColor = '#27ae60';
                } else if (index < supervisorData.length - 3) {
                    rating = '‚úÖ Average';
                    ratingColor = '#f39c12';
                } else {
                    rating = '‚ö†Ô∏è Needs Improvement';
                    ratingColor = '#e74c3c';
                }

                return `
                                        <tr>
                                            <td style="font-weight: bold; color: #3498db; text-align: center; border: 1px solid #dee2e6;">${index + 1}</td>
                                            <td style="border: 1px solid #dee2e6;">${supervisor.supervisor}</td>
                                            <td style="border: 1px solid #dee2e6;">${supervisor.count.toLocaleString('en-IN')}</td>
                                            <td style="border: 1px solid #dee2e6;">‚Çπ${supervisor.amount.toLocaleString('en-IN')}</td>
                                            <td style="border: 1px solid #dee2e6;">‚Çπ${supervisor.efficiency.toFixed(0)}</td>
                                            <td style="color: ${ratingColor}; font-weight: bold; border: 1px solid #dee2e6;">${rating}</td>
                                        </tr>
                                    `;
            }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            document.getElementById('analysisGrid').innerHTML += supervisorAnalysis;
        }

        function generateSupervisorPaymentModeAnalysis() {
            const analysisGrid = document.getElementById('analysisGrid');
            
            // Get all supervisors and their payment mode data
            const supervisorData = Object.entries(processedData.supervisorPaymentModes)
                .map(([supervisor, paymentModes]) => {
                    const totalAmount = Object.values(paymentModes).reduce((sum, mode) => sum + mode.amount, 0);
                    return {
                        supervisor,
                        paymentModes,
                        totalAmount,
                        totalCount: Object.values(paymentModes).reduce((sum, mode) => sum + mode.count, 0)
                    };
                })
                .filter(data => data.supervisor !== 'Unknown') // Filter out unknown supervisors
                .sort((a, b) => b.totalAmount - a.totalAmount); // Sort by total amount

            // Get all unique payment modes for consistent table structure
            const allPaymentModes = [...new Set(
                Object.values(processedData.supervisorPaymentModes)
                    .flatMap(supervisor => Object.keys(supervisor))
            )].sort();

            const supervisorPaymentModeAnalysis = `
                <div class="analysis-card" style="grid-column: 1 / -1;">
                    <h3>üí≥üë• Supervisor-wise Payment Mode Analysis</h3>
                    <div style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 20px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <span style="font-size: 2em; margin-right: 15px;">üìä</span>
                            <div>
                                <h4 style="margin: 0; font-size: 1.4em;">Payment Mode Distribution by Supervisor</h4>
                                <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 1em;">Analyze collection efficiency across different payment channels for each supervisor</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; margin-bottom: 5px;">${supervisorData.length}</div>
                                <div style="font-size: 0.95em; opacity: 0.9;">Active Supervisors</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; margin-bottom: 5px;">${allPaymentModes.length}</div>
                                <div style="font-size: 0.95em; opacity: 0.9;">Payment Modes</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; margin-bottom: 5px;">‚Çπ${supervisorData.reduce((sum, s) => sum + s.totalAmount, 0).toLocaleString('en-IN')}</div>
                                <div style="font-size: 0.95em; opacity: 0.9;">Total Collections</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; margin-bottom: 5px;">${supervisorData.reduce((sum, s) => sum + s.totalCount, 0).toLocaleString('en-IN')}</div>
                                <div style="font-size: 0.95em; opacity: 0.9;">Total Transactions</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-container" style="overflow-x: auto;">
                        <table style="min-width: 800px; border-collapse: collapse; border: 2px solid #34495e;">
                            <thead>
                                <tr style="background: linear-gradient(135deg, #34495e, #2c3e50);">
                                    <th style="position: sticky; left: 0; background: linear-gradient(135deg, #34495e, #2c3e50); z-index: 10; min-width: 60px; border: 1px solid #2c3e50; color: white; padding: 12px 8px; text-align: center;">S.No.</th>
                                    <th style="position: sticky; left: 60px; background: linear-gradient(135deg, #34495e, #2c3e50); z-index: 10; min-width: 200px; border: 1px solid #2c3e50; color: white; padding: 12px 8px;">Supervisor Name</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px; text-align: center;">Total Amount (‚Çπ)</th>
                                    <th style="border: 1px solid #2c3e50; color: white; padding: 12px 8px; text-align: center;">Total Count</th>
                                    ${allPaymentModes.map(mode => `<th style="border: 1px solid #2c3e50; color: white; padding: 12px 6px; text-align: center; min-width: 100px;">${mode}<br>Amount (‚Çπ)</th><th style="border: 1px solid #2c3e50; color: white; padding: 12px 6px; text-align: center; min-width: 80px;">${mode}<br>Count</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${supervisorData.map((supervisor, index) => {
                                    // Find dominant payment mode for this supervisor
                                    const dominantMode = Object.entries(supervisor.paymentModes)
                                        .sort((a, b) => b[1].amount - a[1].amount)[0];
                                    
                                    return `
                                        <tr style="${index % 2 === 0 ? 'background: #f8f9fa;' : 'background: white;'} border-bottom: 1px solid #dee2e6;">
                                            <td style="position: sticky; left: 0; background: ${index % 2 === 0 ? '#f8f9fa' : 'white'}; z-index: 5; font-weight: bold; color: #2c3e50; min-width: 60px; padding: 12px 8px; text-align: center; border: 1px solid #dee2e6; font-size: 1.1em;">
                                                ${index + 1}
                                            </td>
                                            <td style="position: sticky; left: 60px; background: ${index % 2 === 0 ? '#f8f9fa' : 'white'}; z-index: 5; font-weight: bold; color: #2c3e50; min-width: 200px; padding: 12px 8px; border: 1px solid #dee2e6;">
                                                <div style="font-size: 1em; margin-bottom: 4px;">${supervisor.supervisor}</div>
                                                <div style="font-size: 0.8em; color: #7f8c8d; margin-top: 4px;">
                                                    Prefers: <strong style="color: #3498db;">${dominantMode ? dominantMode[0] : 'N/A'}</strong>
                                                    ${dominantMode ? `(‚Çπ${dominantMode[1].amount.toLocaleString('en-IN')})` : ''}
                                                </div>
                                            </td>
                                            <td style="font-weight: bold; color: #27ae60; text-align: center; padding: 12px 8px; border: 1px solid #dee2e6;">‚Çπ${supervisor.totalAmount.toLocaleString('en-IN')}</td>
                                            <td style="font-weight: bold; color: #3498db; text-align: center; padding: 12px 8px; border: 1px solid #dee2e6;">${supervisor.totalCount.toLocaleString('en-IN')}</td>
                                            ${allPaymentModes.map(mode => {
                                                const modeData = supervisor.paymentModes[mode] || { amount: 0, count: 0 };
                                                const isTop = dominantMode && dominantMode[0] === mode;
                                                return `
                                                    <td style="${isTop ? 'background: #e8f5e8; font-weight: bold;' : ''} text-align: center; padding: 12px 6px; border: 1px solid #dee2e6; ${modeData.amount > 0 ? 'color: #27ae60;' : 'color: #95a5a6;'}">‚Çπ${modeData.amount.toLocaleString('en-IN')}</td>
                                                    <td style="${isTop ? 'background: #e8f5e8; font-weight: bold;' : ''} text-align: center; padding: 12px 6px; border: 1px solid #dee2e6; ${modeData.count > 0 ? 'color: #3498db;' : 'color: #95a5a6;'}">${modeData.count.toLocaleString('en-IN')}</td>
                                                `;
                                            }).join('')}
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>

                    <!-- Payment Mode Insights Section -->
                    <div style="margin-top: 25px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        ${allPaymentModes.map(mode => {
                            const modeStats = supervisorData.map(s => {
                                const data = s.paymentModes[mode] || { amount: 0, count: 0 };
                                return { supervisor: s.supervisor, ...data };
                            }).filter(s => s.amount > 0).sort((a, b) => b.amount - a.amount);
                            
                            const totalModeAmount = modeStats.reduce((sum, s) => sum + s.amount, 0);
                            const totalModeCount = modeStats.reduce((sum, s) => sum + s.count, 0);
                            const topPerformer = modeStats[0];
                            
                            return `
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border-left: 4px solid ${mode === 'CASH' ? '#27ae60' : mode === 'UPI' ? '#3498db' : '#e67e22'};">
                                    <h5 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 1.2em; display: flex; align-items: center;">
                                        <span style="font-size: 1.5em; margin-right: 10px;">${mode === 'CASH' ? 'üíµ' : mode === 'UPI' ? 'üì±' : 'üí≥'}</span>
                                        ${mode} Performance
                                    </h5>
                                    
                                    <div style="margin-bottom: 15px;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Total Amount:</span>
                                            <strong style="color: #27ae60;">‚Çπ${totalModeAmount.toLocaleString('en-IN')}</strong>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Total Transactions:</span>
                                            <strong style="color: #3498db;">${totalModeCount.toLocaleString('en-IN')}</strong>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Active Supervisors:</span>
                                            <strong style="color: #9b59b6;">${modeStats.length}</strong>
                                        </div>
                                    </div>
                                    
                                    ${topPerformer ? `
                                        <div style="background: white; padding: 12px; border-radius: 8px; border: 1px solid #ddd;">
                                            <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">üèÜ Top Performer</div>
                                            <div style="font-weight: bold; color: #2c3e50;">${topPerformer.supervisor}</div>
                                            <div style="font-size: 0.9em; color: #27ae60; margin-top: 2px;">‚Çπ${topPerformer.amount.toLocaleString('en-IN')} (${topPerformer.count} transactions)</div>
                                        </div>
                                    ` : `
                                        <div style="background: #fff3cd; padding: 12px; border-radius: 8px; border: 1px solid #ffeaa7; color: #856404;">
                                            <div style="font-size: 0.9em;">‚ö†Ô∏è No collections in this mode</div>
                                        </div>
                                    `}
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <!-- Action Items Section -->
                    ${(() => {
                        const lowPerformers = supervisorData.filter(s => {
                            const avgPerTransaction = s.totalAmount / s.totalCount;
                            const overallAvg = processedData.totalAmount / processedData.totalTransactions;
                            return avgPerTransaction < overallAvg * 0.8;
                        });
                        
                        const cashOnlySupers = supervisorData.filter(s => {
                            const modes = Object.keys(s.paymentModes);
                            return modes.length === 1 && modes[0] === 'CASH';
                        });
                        
                        return `
                            <div style="margin-top: 25px; background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 20px; border-radius: 15px; box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);">
                                <h5 style="margin: 0 0 15px 0; font-size: 1.3em; display: flex; align-items: center;">
                                    <span style="font-size: 1.5em; margin-right: 10px;">‚ö°</span>
                                    Action Items & Recommendations
                                </h5>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                                    ${lowPerformers.length > 0 ? `
                                        <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px;">
                                            <h6 style="margin: 0 0 10px 0; font-size: 1em;">üéØ Performance Support Needed</h6>
                                            <div style="font-size: 0.9em; line-height: 1.4;">
                                                <strong>${lowPerformers.length} supervisors</strong> need training/support:
                                                <div style="margin-top: 8px;">
                                                    ${lowPerformers.slice(0, 3).map(s => `‚Ä¢ ${s.supervisor}`).join('<br>')}
                                                    ${lowPerformers.length > 3 ? `<br>‚Ä¢ +${lowPerformers.length - 3} more...` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    ${cashOnlySupers.length > 0 ? `
                                        <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px;">
                                            <h6 style="margin: 0 0 10px 0; font-size: 1em;">üì± Digital Payment Training</h6>
                                            <div style="font-size: 0.9em; line-height: 1.4;">
                                                <strong>${cashOnlySupers.length} supervisors</strong> only collect cash:
                                                <div style="margin-top: 8px;">
                                                    ${cashOnlySupers.slice(0, 3).map(s => `‚Ä¢ ${s.supervisor}`).join('<br>')}
                                                    ${cashOnlySupers.length > 3 ? `<br>‚Ä¢ +${cashOnlySupers.length - 3} more...` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px;">
                                        <h6 style="margin: 0 0 10px 0; font-size: 1em;">üí° Key Insights</h6>
                                        <div style="font-size: 0.9em; line-height: 1.4;">
                                            ‚Ä¢ Promote digital payment adoption<br>
                                            ‚Ä¢ Provide UPI training to supervisors<br>
                                            ‚Ä¢ Monitor collection efficiency<br>
                                            ‚Ä¢ Implement performance incentives
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    })()} 
                </div>
            `;

            document.getElementById('analysisGrid').innerHTML += supervisorPaymentModeAnalysis;
        }

        function generateExecutiveSummary() {
            const topPaymentMode = Object.entries(processedData.paymentModes)
                .sort((a, b) => b[1].amount - a[1].amount)[0];

            const lowestPaymentMode = Object.entries(processedData.paymentModes)
                .sort((a, b) => a[1].amount - b[1].amount)[0];

            const topZone = Object.entries(processedData.zones)
                .sort((a, b) => b[1].amount - a[1].amount)[0];

            const topSupervisor = Object.entries(processedData.supervisors)
                .sort((a, b) => b[1].amount - a[1].amount)[0];

            const lowestSupervisor = Object.entries(processedData.supervisors)
                .sort((a, b) => a[1].amount - b[1].amount)[0];

            const topPropertyType = Object.entries(processedData.propertyTypes)
                .sort((a, b) => b[1].amount - a[1].amount)[0];

            const topPropertySubType = Object.entries(processedData.propertySubTypes)
                .sort((a, b) => b[1].amount - a[1].amount)[0];

            const summary = `
                <div class="summary-section">
                    <h3>üìã Executive Summary - Daily Performance Report</h3>
                    <ul class="summary-points">
                        <li><strong>1. Total Collection Performance:</strong> ‚Çπ${processedData.totalAmount.toLocaleString('en-IN')} from ${processedData.totalTransactions} transactions (Average: ‚Çπ${(processedData.totalAmount / processedData.totalTransactions).toFixed(0)} per transaction)</li>
                        <li><strong>2. Payment Mode Analysis:</strong> ${topPaymentMode[0]} leads with ‚Çπ${topPaymentMode[1].amount.toLocaleString('en-IN')} (${((topPaymentMode[1].amount / processedData.totalAmount) * 100).toFixed(1)}% of total collections)</li>
                        <li><strong>3. Payment Mode Performance:</strong> ${lowestPaymentMode[0]} shows lowest contribution with ‚Çπ${lowestPaymentMode[1].amount.toLocaleString('en-IN')} (${((lowestPaymentMode[1].amount / processedData.totalAmount) * 100).toFixed(1)}% of total)</li>
                        <li><strong>4. Geographic Performance:</strong> Zone ${topZone[0]} achieved highest collections of ‚Çπ${topZone[1].amount.toLocaleString('en-IN')} from ${topZone[1].count} transactions</li>
                        <li><strong>5. Ward Coverage Status:</strong> ${processedData.activeWards.size} out of ${processedData.totalWards} wards (${((processedData.activeWards.size / processedData.totalWards) * 100).toFixed(1)}%) are actively generating revenue</li>
                        ${processedData.inactiveWards.length > 0 ? `<li><strong>6. Critical Revenue Gap:</strong> ${processedData.inactiveWards.length} wards with zero collections: ${processedData.inactiveWards.join(', ')}</li>` : ''}
                        <li><strong>7. Top Supervisor Performance:</strong> ${topSupervisor[0]} achieved maximum collections of ‚Çπ${topSupervisor[1].amount.toLocaleString('en-IN')} from ${topSupervisor[1].count} transactions</li>
                        <li><strong>8. Supervisor Support Required:</strong> ${lowestSupervisor[0]} needs assistance with ‚Çπ${lowestSupervisor[1].amount.toLocaleString('en-IN')} from ${lowestSupervisor[1].count} transactions</li>
                        <li><strong>9. Property Type Performance:</strong> ${topPropertyType[0]} properties dominate with ‚Çπ${topPropertyType[1].amount.toLocaleString('en-IN')} (${((topPropertyType[1].amount / processedData.totalAmount) * 100).toFixed(1)}% of total collections)</li>
                        <li><strong>10. Property Category Insight:</strong> ${topPropertySubType[0]} leads sub-categories with ‚Çπ${topPropertySubType[1].amount.toLocaleString('en-IN')} from ${topPropertySubType[1].count} properties</li>
                        ${processedData.anomalies.length > 0 ? `<li><strong>11. Data Anomalies:</strong> ${processedData.anomalies.length} zero-collection transactions identified requiring investigation</li>` : ''}
                    </ul>
                    
                    <h4 style="margin-top: 25px; margin-bottom: 15px;">üéØ Strategic Recommendations:</h4>
                    <ul class="summary-points">
                        ${processedData.inactiveWards.length > 0 ? `<li><strong>1. URGENT ACTION:</strong> Deploy supervisors to ${processedData.inactiveWards.length} inactive wards (${processedData.inactiveWards.join(', ')}) for immediate revenue recovery</li>` : ''}
                        <li><strong>2. Supervisor Development:</strong> Provide training and support to supervisors with below-average collection efficiency</li>
                        <li><strong>3. Anomaly Resolution:</strong> Investigate and resolve zero-collection anomalies to maximize revenue potential</li>
                        <li><strong>4. Coverage Optimization:</strong> Achieve 100% ward coverage by addressing all inactive zones systematically</li>
                        <li><strong>5. Payment Digitization:</strong> Promote digital payment methods to reduce cash handling overhead and improve efficiency</li>
                        <li><strong>6. Performance Incentives:</strong> Implement reward systems for top-performing zones and supervisors to maintain excellence</li>
                        <li><strong>7. Best Practice Sharing:</strong> Conduct zone-wise analysis workshops to replicate successful collection strategies</li>
                    </ul>
                </div>
            `;

            document.getElementById('analysisGrid').innerHTML += summary;
        }

        // Initialize
        console.log('UCC Revenue Analysis Dashboard initialized');
    </script>
</body>

</html>